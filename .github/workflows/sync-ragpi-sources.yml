name: sync-ragpi-sources

on:
  schedule:
    # Run daily at midnight UTC
    - cron: '0 0 * * *'
  workflow_dispatch:
    # Allow manual trigger
    inputs:
      github_org:
        description: 'GitHub organization to scan'
        required: false
        default: 'eidp'
      github_topic:
        description: 'GitHub topic to filter by'
        required: false
        default: 'github-actions'
      sitemap_urls:
        description: 'Comma-separated sitemap URLs to sync'
        required: false
        default: 'https://docs.eidp.com/sitemap.xml, https://eidp.com/page-sitemap.xml'

jobs:
  sync-sources:
    runs-on: kubernetes-runner

    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Set up Python
        uses: actions/setup-python@83679a892e2d95755f2dac6acb0bfd1e9ac5d548 # v6.1.0
        with:
          python-version: '3.14'

      - name: Install dependencies
        run: |
          pip install requests

      - name: Run sync script
        env:
          GITHUB_TOKEN: ${{ github.token }}
          RAGPI_API_KEY: ${{ secrets.RAGPI_API_KEY }}
          RAGPI_HOST: https://ragpi.eidp.com
          GITHUB_ORG: ${{ github.event.inputs.github_org || 'eidp' }}
          GITHUB_TOPIC: 'github-actions'
          SITEMAP_URLS: ${{ github.event.inputs.sitemap_urls || 'https://docs.eidp.com/sitemap.xml, https://eidp.com/page-sitemap.xml' }}
        run: python scripts/sync_sources.py
